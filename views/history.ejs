<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>History | GPT-Chatbot</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
  </head>
  <style>
    *{
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    #userPrompt{
      background-color: rgb(82, 82, 253);
      padding: 10px;
      color: white;
      border-radius: 10px;
    }
    #botResponse{
      background-color: #8d8d8d;
      padding: 10px;
      color: white;
      border-radius: 10px;
    }
    #time{
      font-size: 12px;
    }
    .historyBox{
      background-color: #dadada;
      padding: 2px 10px;
      border-radius: 10px;
    }
  </style>
  <body>
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content px-5">
          <div class="modal-header">
            <h5 class="modal-title">Delete All History</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
            <h6 class="text-center my-4"> Do You Want To Delete All History For <%= firstName %>?</h6>
            <a class="btn btn-danger mt-2 mb-4" href="/api/clear" id="modalDeleteBtn">Yes, Delete</a>
          </div>
        </div>
      </div>
    <h1 class="my-4 text-center">All of your history is saved here ðŸ“·ðŸ“¢</h1>
    <div
      class="container d-flex align-items-center justify-content-center"
    >
      <a class="btn btn-primary text-center mb-4 mx-2" href="/">Go back to chatbot ðŸ“ŒðŸš€</a>
      <button class="btn btn-danger text-center mb-4 mx-2" data-bs-toggle="modal" data-bs-target="#deleteModal">Delete History âœ…</button>
      <% if(role === "ADMIN"){%>
        <a class="btn btn-warning text-center mb-4 mx-2" href="/admin">Go To Admin ðŸ¤¡</a>
      <% } %>
    </div>
    <div class="container">
      <% if (results && results.length > 0) { %>
        <% results.forEach(result => { %>
          <div class="my-4 historyBox">
            <div class="d-flex align-items-center justify-content-between my-2">
              <p id="time"><%= result.createdAt %></p>
              <button class="btn btn-danger">Delete</button>
            </div>
            <p id="userPrompt">
              <b><%= firstName %>:</b>
              <%= result.userQuery %>
            </p>
            <p class="mb-5" id="botResponse">
              <b>Chatbot:</b>
              <%= result.botResponse %>
            </p>
          </div>
          <% }); %>
        <% } else { %>
          <h4 class="text-center mt-4">No Search History To Display ðŸ¤¡</h4>
        <% } %>
    </div>    
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
